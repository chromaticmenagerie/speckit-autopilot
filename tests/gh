#!/usr/bin/env bash
# mock-gh â€” Mock gh CLI for testing autopilot-github.sh
# Records all calls and returns canned responses.

MOCK_LOG="${GH_MOCK_LOG:-/tmp/gh-mock-calls.log}"
echo "$@" >> "$MOCK_LOG"

case "$*" in
    *"auth status"*)
        echo "Logged in to github.com account testuser"
        ;;
    *"api user"*"login"*)
        echo "testuser"
        ;;
    *"api user"*)
        echo '{"login":"testuser"}'
        ;;
    *"project list"*)
        echo '{"projects":[]}'
        ;;
    *"project create"*)
        echo '{"number":1,"title":"Autopilot: test-repo"}'
        ;;
    *"project view"*"--jq"*)
        echo "PVT_test123"
        ;;
    *"project view"*)
        echo '{"id":"PVT_test123","number":1}'
        ;;
    *"project link"*)
        echo "Linked"
        ;;
    *"project field-delete"*)
        echo "Deleted"
        ;;
    *"project field-create"*)
        echo '{"id":"PVTSSF_test"}'
        ;;
    *"project field-list"*)
        cat <<'FIELDS'
{"fields":[{"name":"Status","id":"PVTSSF_test","options":[{"name":"Backlog","id":"opt_backlog"},{"name":"Specify","id":"opt_specify"},{"name":"Clarify","id":"opt_clarify"},{"name":"Plan","id":"opt_plan"},{"name":"Tasks","id":"opt_tasks"},{"name":"Analyze","id":"opt_analyze"},{"name":"Implement","id":"opt_implement"},{"name":"Review","id":"opt_review"},{"name":"Merged","id":"opt_merged"},{"name":"Done","id":"opt_done"}]}]}
FIELDS
        ;;
    *"project item-add"*)
        echo '{"id":"PVTI_item123"}'
        ;;
    *"project item-edit"*)
        echo '{"id":"PVTI_item123"}'
        ;;
    *"issue create"*)
        echo "https://github.com/testorg/test-repo/issues/42"
        ;;
    *"issue close"*)
        echo "Closed"
        ;;
    *"issue edit"*)
        echo "Edited"
        ;;
    *"label create"*)
        echo "Label created"
        ;;
    *)
        echo "{}"
        ;;
esac
